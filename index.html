<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Photo Editor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef } = React;

        // Lucide icons as SVG components
        const Upload = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
        );

        const ImageIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
            </svg>
        );

        const Film = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                <line x1="7" y1="2" x2="7" y2="22"/>
                <line x1="17" y1="2" x2="17" y2="22"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <line x1="2" y1="7" x2="7" y2="7"/>
                <line x1="2" y1="17" x2="7" y2="17"/>
                <line x1="17" y1="17" x2="22" y2="17"/>
                <line x1="17" y1="7" x2="22" y2="7"/>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const FilmPhotoEditor = () => {
          const [images, setImages] = useState([]);
          const [selectedStyle, setSelectedStyle] = useState('portra400');
          const [processing, setProcessing] = useState(false);
          const [progress, setProgress] = useState(0);
          const fileInputRef = useRef(null);
          const canvasRef = useRef(null);

          const filmStyles = {
            portra400: {
              name: 'Kodak Portra 400',
              brightness: 1.05,
              contrast: 1.1,
              saturation: 1.15,
              warmth: 1.08,
              highlights: 0.95,
              shadows: 1.05,
              grainIntensity: 0.015,
              vignette: 0.3,
              colorBleed: 0.5,
              curves: { r: 1.02, g: 1.0, b: 0.98 }
            },
            portra800: {
              name: 'Kodak Portra 800',
              brightness: 1.08,
              contrast: 1.05,
              saturation: 1.2,
              warmth: 1.12,
              highlights: 0.93,
              shadows: 1.08,
              grainIntensity: 0.025,
              vignette: 0.35,
              colorBleed: 0.6,
              curves: { r: 1.03, g: 1.0, b: 0.97 }
            },
            ektar100: {
              name: 'Kodak Ektar 100',
              brightness: 1.0,
              contrast: 1.25,
              saturation: 1.4,
              warmth: 1.05,
              highlights: 0.9,
              shadows: 1.1,
              grainIntensity: 0.008,
              vignette: 0.25,
              colorBleed: 0.4,
              curves: { r: 1.05, g: 1.02, b: 0.98 }
            },
            gold200: {
              name: 'Kodak Gold 200',
              brightness: 1.1,
              contrast: 1.15,
              saturation: 1.25,
              warmth: 1.15,
              highlights: 0.92,
              shadows: 1.12,
              grainIntensity: 0.02,
              vignette: 0.4,
              colorBleed: 0.7,
              curves: { r: 1.08, g: 1.03, b: 0.95 }
            },
            velvia50: {
              name: 'Fuji Velvia 50',
              brightness: 0.98,
              contrast: 1.35,
              saturation: 1.5,
              warmth: 1.0,
              highlights: 0.85,
              shadows: 1.15,
              grainIntensity: 0.01,
              vignette: 0.3,
              colorBleed: 0.3,
              curves: { r: 1.0, g: 1.05, b: 1.08 }
            },
            provia100: {
              name: 'Fuji Provia 100F',
              brightness: 1.0,
              contrast: 1.2,
              saturation: 1.1,
              warmth: 1.0,
              highlights: 0.9,
              shadows: 1.08,
              grainIntensity: 0.012,
              vignette: 0.25,
              colorBleed: 0.35,
              curves: { r: 1.0, g: 1.0, b: 1.0 }
            },
            superia400: {
              name: 'Fuji Superia 400',
              brightness: 1.05,
              contrast: 1.12,
              saturation: 1.2,
              warmth: 1.06,
              highlights: 0.93,
              shadows: 1.06,
              grainIntensity: 0.018,
              vignette: 0.35,
              colorBleed: 0.55,
              curves: { r: 1.02, g: 1.01, b: 0.99 }
            },
            cinestill800t: {
              name: 'CineStill 800T',
              brightness: 1.1,
              contrast: 1.08,
              saturation: 1.15,
              warmth: 0.92,
              highlights: 0.88,
              shadows: 1.1,
              grainIntensity: 0.022,
              vignette: 0.4,
              colorBleed: 0.8,
              curves: { r: 0.98, g: 1.0, b: 1.08 }
            }
          };

          const handleFileSelect = (e) => {
            const files = Array.from(e.target.files);
            const newImages = files.map(file => ({
              id: Date.now() + Math.random(),
              file,
              url: URL.createObjectURL(file),
              processed: false,
              processedUrl: null
            }));
            setImages(prev => [...prev, ...newImages]);
          };

          const removeImage = (id) => {
            setImages(prev => prev.filter(img => img.id !== id));
          };

          const applyFilmEffect = (imageData, style) => {
            const data = imageData.data;
            const width = imageData.width;
            const height = imageData.height;
            const params = filmStyles[style];

            // Apply color grading and curves
            for (let i = 0; i < data.length; i += 4) {
              let r = data[i];
              let g = data[i + 1];
              let b = data[i + 2];

              r *= params.brightness;
              g *= params.brightness;
              b *= params.brightness;

              r *= params.warmth;
              b /= params.warmth;

              r = ((r / 255 - 0.5) * params.contrast + 0.5) * 255;
              g = ((g / 255 - 0.5) * params.contrast + 0.5) * 255;
              b = ((b / 255 - 0.5) * params.contrast + 0.5) * 255;

              const gray = 0.299 * r + 0.587 * g + 0.114 * b;
              r = gray + (r - gray) * params.saturation;
              g = gray + (g - gray) * params.saturation;
              b = gray + (b - gray) * params.saturation;

              r *= params.curves.r;
              g *= params.curves.g;
              b *= params.curves.b;

              const luminance = (r + g + b) / 3;
              if (luminance > 128) {
                r *= params.highlights;
                g *= params.highlights;
                b *= params.highlights;
              } else {
                r *= params.shadows;
                g *= params.shadows;
                b *= params.shadows;
              }

              data[i] = Math.max(0, Math.min(255, r));
              data[i + 1] = Math.max(0, Math.min(255, g));
              data[i + 2] = Math.max(0, Math.min(255, b));
            }

            // Apply chromatic aberration
            const tempData = new Uint8ClampedArray(data);
            const offsetAmount = params.colorBleed;
            
            for (let y = 0; y < height; y++) {
              for (let x = 0; x < width; x++) {
                const idx = (y * width + x) * 4;
                const dx = (x / width - 0.5) * offsetAmount;
                
                const rx = Math.floor(x + dx);
                const bx = Math.floor(x - dx);
                
                if (rx >= 0 && rx < width) {
                  const ridx = (y * width + rx) * 4;
                  data[idx] = tempData[ridx];
                }
                
                if (bx >= 0 && bx < width) {
                  const bidx = (y * width + bx) * 4;
                  data[idx + 2] = tempData[bidx + 2];
                }
              }
            }

            // Apply film grain
            for (let i = 0; i < data.length; i += 4) {
              const noise = (Math.random() - 0.5) * params.grainIntensity * 255;
              data[i] += noise;
              data[i + 1] += noise;
              data[i + 2] += noise;
            }

            // Apply vignette
            const centerX = width / 2;
            const centerY = height / 2;
            const maxDist = Math.sqrt(centerX * centerX + centerY * centerY);

            for (let y = 0; y < height; y++) {
              for (let x = 0; x < width; x++) {
                const dx = x - centerX;
                const dy = y - centerY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const vignette = 1 - (dist / maxDist) * params.vignette;
                
                const idx = (y * width + x) * 4;
                data[idx] *= vignette;
                data[idx + 1] *= vignette;
                data[idx + 2] *= vignette;
              }
            }

            return imageData;
          };

          const processImage = (image) => {
            return new Promise((resolve) => {
              const img = new Image();
              img.onload = () => {
                const canvas = canvasRef.current;
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d', { willReadFrequently: true });
                
                ctx.drawImage(img, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                
                const processed = applyFilmEffect(imageData, selectedStyle);
                ctx.putImageData(processed, 0, 0);
                
                canvas.toBlob((blob) => {
                  const url = URL.createObjectURL(blob);
                  resolve(url);
                }, 'image/jpeg', 0.95);
              };
              img.src = image.url;
            });
          };

          const processAllImages = async () => {
            setProcessing(true);
            setProgress(0);
            
            const updatedImages = [...images];
            
            for (let i = 0; i < images.length; i++) {
              const processedUrl = await processImage(images[i]);
              updatedImages[i] = {
                ...updatedImages[i],
                processed: true,
                processedUrl
              };
              
              setProgress(Math.round(((i + 1) / images.length) * 100));
              setImages([...updatedImages]);
              
              // Small delay to let UI breathe
              await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            setProcessing(false);
            setProgress(0);
          };

          const downloadImage = (image) => {
            const link = document.createElement('a');
            link.href = image.processedUrl || image.url;
            link.download = `film-${selectedStyle}-${image.file.name}`;
            link.click();
          };

          const downloadAll = () => {
            images.forEach((img, idx) => {
              if (img.processedUrl) {
                setTimeout(() => downloadImage(img), idx * 100);
              }
            });
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-8">
              <div className="max-w-7xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold mb-3 bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">
                    Film Style Photo Editor
                  </h1>
                  <p className="text-gray-400">Transform your photos with authentic film aesthetics</p>
                </div>

                <div className="grid md:grid-cols-3 gap-6 mb-8">
                  <div className="md:col-span-2 bg-gray-800 rounded-2xl p-6 border border-gray-700">
                    <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                      <Upload />
                      Upload Photos
                    </h2>
                    
                    <input
                      type="file"
                      ref={fileInputRef}
                      onChange={handleFileSelect}
                      accept="image/*"
                      multiple
                      className="hidden"
                    />
                    
                    <button
                      onClick={() => fileInputRef.current.click()}
                      className="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 py-4 rounded-xl font-semibold transition-all duration-200 flex items-center justify-center gap-2"
                    >
                      <ImageIcon />
                      Select Photos
                    </button>

                    {images.length > 0 && (
                      <div className="mt-6 grid grid-cols-3 gap-3">
                        {images.map(img => (
                          <div key={img.id} className="relative group">
                            <img
                              src={img.processedUrl || img.url}
                              alt="Upload"
                              className="w-full h-32 object-cover rounded-lg border-2 border-gray-700"
                            />
                            <button
                              onClick={() => removeImage(img.id)}
                              className="absolute top-1 right-1 bg-red-600 hover:bg-red-700 p-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"
                            >
                              <Trash2 />
                            </button>
                            {img.processed && (
                              <div className="absolute inset-0 bg-green-500 bg-opacity-20 rounded-lg flex items-center justify-center">
                                <span className="text-xs bg-green-600 px-2 py-1 rounded">Processed</span>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    )}
                  </div>

                  <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                    <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                      <Film />
                      Film Style
                    </h2>
                    
                    <div className="space-y-2">
                      {Object.entries(filmStyles).map(([key, style]) => (
                        <button
                          key={key}
                          onClick={() => setSelectedStyle(key)}
                          className={`w-full text-left px-4 py-3 rounded-lg transition-all duration-200 ${
                            selectedStyle === key
                              ? 'bg-gradient-to-r from-amber-600 to-orange-600 shadow-lg'
                              : 'bg-gray-700 hover:bg-gray-600'
                          }`}
                        >
                          <div className="font-semibold">{style.name}</div>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                {images.length > 0 && (
                  <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                    <div className="flex gap-4 justify-center flex-wrap">
                      <button
                        onClick={processAllImages}
                        disabled={processing}
                        className="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 disabled:from-gray-600 disabled:to-gray-700 px-8 py-4 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2"
                      >
                        <Film />
                        {processing ? `Processing... ${progress}%` : `Apply ${filmStyles[selectedStyle].name}`}
                      </button>
                      
                      {images.some(img => img.processed) && (
                        <button
                          onClick={downloadAll}
                          className="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 px-8 py-4 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2"
                        >
                          <Download />
                          Download All
                        </button>
                      )}
                    </div>
                  </div>
                )}

                <canvas ref={canvasRef} style={{ display: 'none' }} />
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FilmPhotoEditor />);
    </script>
</body>
</html>